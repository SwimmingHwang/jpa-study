# 엔터티 매핑

# 객체와 테이블 매핑

객체와 테이블 매핑: **`@Entity`, `@Table`**

필드와 컬럼 매핑: **`@Column`**

기본 키 매핑: **`@Id`**

연관관계 매핑: **`@ManyToOne`,`@JoinColumn`**

## `@Entity`

- @Entity가 붙은 클래스는 JPA가 관리

- JPA를 사용해서 테이블과 매핑할 클래스는 **@Entity** 필수

- **기본 생성자 필수**(파라미터가 없는 public 또는 protected 생성자)

    - JPA가 엔터티 객체를 생성할 때 기본생성자를 사용하므로 이 생성자는 반드시 있어야 한다.

    - 자바는 생성자가 하나도 없으면 기본 생성자를 자동으로 만든다

      ```java
      public Member(){} //기본 생성자
      ```

    - **문제는 생성자를 하나 이상 만들면 자바는 기본 생성자를 자동으로 만들지 않기 때문에 기본 생성자를 직접 만들어야 한다.**

    - JPA를 구현하는 라이브러리가 reflection 을 써서.. 기본생성자가 필수다.

- final 클래스, enum, interface, inner 클래스 사용X

- 저장할 필드에 final 사용 X

## `@Table`

- @Table은 엔티티오 매핑할 테이블 지정
    - name : 매핑할 테이블 이름(default : 엔티티 명)
    - catablog : 데이터베이스 catalog 매핑
    - schema : 데이터베이스 schema 매핑
    - uniqueConstrains : DDL생성 시에 유니크 제약 조건 생성

# 데이터베이스 스키마 자동 생성

- DDL 을 애플리케이션 실행 시점에 자동 생성
- 테이블 중심 → 객체 중심
- 개발 장비에서만 사용할 것
- 생성된 DDL은 운영서버에서는 사용하지 않거나 적절히 다듬은 후 사용

### **[hibernate.hbm2ddl.auto](http://hibernate.hbm2ddl.auto) 속성**

- create : 기존 테이블 삭제 후 다시 생성 (DROP + CREATE)
- create-drop : create와 같으나 종료시점에 테이블 (DROP)
- update : 변경분만 반영 (운영 DB에는 사용하면 안 됨)
- validate : 엔티티와 테이블이 정상 매핑 되었는지만 확인
- none : 사용하지 않음

### 주의할 점

- 운**영 장비에는 절대 create, create-drop, update 사용하면
  안된다.**
- 개발 초기 단계는 create 또는 update
- 테스트 서버는 update 또는 validate
- 스테이징과 운영 서버는 validate 또는 none

### DDL 생성 기능 - 제약 조건

**@Column(nullable = false, length = 10)**

DDL을 자동 생성할 때만 사용되고 JPA의 실행 로직에는 영향을 주지 않는다

### 이름 매핑 전략

- hibername.ejb.naming_strategy 속성 사용하면 이름 매핑 전략 변경 가능

```java
@Column(name="role_type") // 언더스코드(_)
Stringg roleType; // 카멜표기법
```

## 필드와 컬럼 매핑

```java
package hellojpa;

import javax.persistence.*; 
import java.time.LocalDate;
import java.time.LocalDateTime;
import java.util.Date;

@Entity
public class Member {
	@Id
	private Long id;
	@Column(name = "name")
	private String username;private Integer age;
	@Enumerated(EnumType.STRING)
	private RoleType roleType;
	@Temporal(TemporalType.TIMESTAMP)
	private Date createdDate;
	@Temporal(TemporalType.TIMESTAMP)
	private Date lastModifiedDate;
	@Lob
	private String description;
}
```