## 값 타입 컬렉션

- 엔터티가 컬렉션을 가지는 경우 (현재까지 배운 내용으로 2경우가 있다)

  - 첫번째, 엔터티 `Parent` `Child`  엔터티가 일대다 관계 (혹은 다대일, 혹은 다대다)

    ```java
    @OneToMany (mappedBy = "parent") 
    private List<Child> childList = new ArrayList<>();
    ```

  - 두번째, 이번 파트의 내용인  [엔터티-값] **값 타입 컬렉션** 이다.
    *값 타입 : `int`, `Integer`, `String` 처럼 단순히 값으로 사용하는 자바 기본 타입이나 객체를 값 타입이라고 부르며, 자바 기본 타입(int, double), Reference Type(Integer, Long), String, Address 객체와 같은 임베디드 타입이 있다.  
    
    ```java
    @ElementCollection
    @CollectionTable(name = "ADDRESS", joinColumns = {
        @JoinColumn(name = "MEMBER_ID")
    })
    private List<Address> addressHistory = new ArrayList<>();
    ```
    
    - ```java
      public class Address { // 엔터티 아님. 임베디드 타입 객체
        private String city;
        private String street;
        private String zipcode;
      }
      ```
    
  - 즉, [엔터티-엔터티] 일대다 관계가 아니더라도 컬렉션을 가질 수 있다 => 이를 [엔터티-값] **값 타입 컬렉션** 이다.

- Address 는 엔터티가 아니라 임베디드 타입이다.  
  Address 임베디드 타입을 컬렉션으로 가지면 값타입 컬렉선이다. 

- **여기서 생각해야 할 것. Address 는 Entity가 아니다!** 

- 참고 :  엔터티 타입 컬렉션은 엔터티 끼리 일대다 관계를 가진다. (여기서 Address는 Entity가 아니기에 엔터티 일대다 관계가 아니다.  일대다 관계가 아니더라도 엔터티는 컬렉션을 가질 수 있다. - 물론 테이블은 일대다 관계임.)

  



<img src="..\image\image-20220221172149502.png" alt="image-20220221172149502" style="zoom: 67%;" />

#### 값 타입 컬렉션 특징

- 값 타입을 하나 이상 저장할 때 사용
- @ElementCollection, @CollectionTable 사용
- 데이터베이스는 컬렉션을 같은 테이블에 저장할 수 없다
  - 이런 컬렉션 들은 일대다 개념이기에 한 테이블에 넣을 수 있는 방법이 없다. 일대다로 풀어서 별도의 테이블로 풀어야 한다. 
- 컬렉션을 저장하기 위한 별도의 테이블이 필요

즉, 

- 위와 같이 Member 엔터티를 구성하려면 Favorite_food 테이블과 Address 테이블이 생성되어야 한다. 

  

### 예제

```java
@Getter
@Setter
@Entity
public class Member {

  @Id
  @GeneratedValue
  @Column(name = "MEMBER_ID")
  private Long id;
  private String name;

  @Embedded 
  private Peroid workPeroid;

  @Embedded
  private Address homeAddress;

  @ElementCollection
  @CollectionTable(name = "FAVORITE_FOOD", joinColumns = {
      @JoinColumn(name = "MEMBER_ID") // 외래키로 member_id 를 설정한다
  })
  @Column(name = "FOOD_NAME") // favorite food 테이블을 만들 때 예외적으로 food_name 이라는 이름으로 컬럼을 만든다
  private Set<String> favoriteFoods = new HashSet<>();

  @ElementCollection
  @CollectionTable(name = "ADDRESS", joinColumns = {
      @JoinColumn(name = "MEMBER_ID")
  })
  private List<Address> addressHistory = new ArrayList<>(); // 임베디드 타입이라서 address 테이블에 컬럼들은 안에 속성 명으로 컬렴이 생성된다
}


```



```sql
    create table Member (
       MEMBER_ID bigint not null,
        city varchar(255),
        street varchar(255),
        zipcode varchar(255),
        name varchar(10),
        endDate timestamp,
        startDate timestamp,
        primary key (MEMBER_ID)
    )
    create table ADDRESS (
       MEMBER_ID bigint not null,
        city varchar(255),
        street varchar(255),
        zipcode varchar(255)
    )
    
    create table FAVORITE_FOOD (
       MEMBER_ID bigint not null,
        FOOD_NAME varchar(255)
    )
```



> 'Embedded' attribute type should not be a container 

- 이 에러는 `Set<String> favoriteFoods` `List<Address> addressHistory` 이 필드들에 

  `@ElementCollection`   `@CollectionTable` 이 어노테이션 안 달면 생김. 
